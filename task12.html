<!DOCTYPE html>
<html>
<head>
    <title>Task 12 - Campus RideShare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map { height: 250px; border-radius: 15px; margin-bottom: 20px; z-index: 1; }
        body { background: #f1f5f9; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-4xl mx-auto">
        <header class="bg-emerald-600 p-6 rounded-2xl text-white shadow-lg mb-6">
            <h1 class="text-2xl font-black italic">CAMPUS RIDE-SHARE</h1>
            <p class="text-xs opacity-80 uppercase font-bold">Reduce Carbon | Save Fuel</p>
        </header>

        <div id="map"></div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-emerald-100">
                <h2 class="font-bold mb-4 text-emerald-800">Post a Ride</h2>
                <input id="route" type="text" placeholder="From -> To (e.g. North Gate to Block C)" class="w-full p-2 border rounded mb-2 text-sm">
                <div class="flex gap-2 mb-2">
                    <input id="time" type="time" class="p-2 border rounded flex-1 text-sm">
                    <input id="seats" type="number" placeholder="Seats" class="p-2 border rounded w-20 text-sm">
                </div>
                <button onclick="postRide()" class="w-full bg-emerald-500 text-white font-bold py-2 rounded-lg hover:bg-emerald-600 transition">POST RIDE</button>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-emerald-100">
                <h2 class="font-bold mb-4 text-emerald-800">Available Rides</h2>
                <div id="rideList" class="space-y-3">
                    </div>
            </div>

        </div>
    </div>

    <script>
        // Init Map (Human touch: Default to a generic campus-like area)
        var map = L.map('map').setView([51.505, -0.09], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        
        // My ride data
        let rides = [
            { id: 1, route: "Hostel to Library", time: "09:00", seats: 3, history: "5 rides completed" },
            { id: 2, route: "Metro Station to Gate 1", time: "08:30", seats: 2, history: "12 rides completed" }
        ];

        function showRides() {
            const list = document.getElementById('rideList');
            list.innerHTML = rides.map(r => `
                <div class="p-3 bg-emerald-50 rounded-lg border border-emerald-200">
                    <div class="flex justify-between items-center">
                        <p class="font-bold text-sm text-emerald-900">${r.route}</p>
                        <span class="bg-emerald-200 text-emerald-800 text-[10px] px-2 py-1 rounded font-bold">${r.seats} SEATS LEFT</span>
                    </div>
                    <p class="text-[10px] text-slate-500 mt-1">üïí Departs: ${r.time} | ‚≠ê ${r.history}</p>
                    <button onclick="bookSeat(${r.id})" class="mt-2 w-full bg-white border border-emerald-500 text-emerald-600 py-1 rounded text-xs font-bold hover:bg-emerald-500 hover:text-white transition">BOOK SEAT</button>
                </div>
            `).join('');
        }

        function postRide() {
            const route = document.getElementById('route').value;
            const time = document.getElementById('time').value;
            const seats = document.getElementById('seats').value;

            if(!route || !time || !seats) return alert("Fill all fields!");

            // Add to our list (Simulation)
            rides.push({ 
                id: Date.now(), 
                route: route, 
                time: time, 
                seats: parseInt(seats), 
                history: "New Driver" 
            });

            // Add marker to map to show "Route Visualization"
            L.marker([51.5 + (Math.random()*0.01), -0.09 + (Math.random()*0.01)]).addTo(map)
                .bindPopup('Ride Posted: ' + route).openPopup();

            showRides();
            alert("Ride posted successfully!");
        }

        function bookSeat(id) {
            const ride = rides.find(r => r.id === id);
            if(ride.seats > 0) {
                ride.seats -= 1; // Real-time seat tracking
                alert("Seat booked! Ride history updated.");
                showRides();
            } else {
                alert("No seats left!");
            }
        }

        showRides();
    </script>
</body>
</html>
