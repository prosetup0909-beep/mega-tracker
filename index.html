<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Air Quality | Professional Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0b0f19; color: #f8fafc; }
        .mega-glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .status-pill { padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
        .stat-card { background: rgba(15, 23, 42, 0.6); border-radius: 16px; padding: 20px; border: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body class="min-h-screen">

    <nav class="w-full p-6 flex justify-between items-center border-b border-white/5">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
            <span class="font-extrabold tracking-tighter text-xl italic">MEGA WEATHER</span>
        </div>
        <div class="text-xs text-slate-500 font-mono" id="lastUpdated">LIVE MONITORING</div>
    </nav>

    <main class="max-w-5xl mx-auto p-6">
        
        <section class="mt-8 mb-12">
            <div class="mega-glass p-2 rounded-2xl flex shadow-2xl">
                <input id="cityInput" type="text" placeholder="Search City (e.g. Karachi, New York, London)..." 
                       class="flex-1 bg-transparent px-6 py-4 outline-none text-lg placeholder:text-slate-600">
                <button onclick="fetchData()" class="bg-blue-600 hover:bg-blue-700 text-white px-10 py-4 rounded-xl font-bold transition-all active:scale-95">
                    UPDATE DATA
                </button>
            </div>
        </section>

        <div id="dashboard" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-1">
                <div id="mainCard" class="mega-glass rounded-3xl p-8 flex flex-col items-center text-center h-full border-t-4">
                    <h2 id="cityNameDisplay" class="text-3xl font-light text-slate-400">---</h2>
                    <h1 id="aqiValue" class="text-[120px] font-black leading-none my-4">0</h1>
                    <div id="aqiLabel" class="text-2xl font-bold uppercase tracking-widest mb-4">PENDING</div>
                    <p id="aqiDesc" class="text-sm text-slate-400">Fetching real-time atmospheric data for requested coordinates.</p>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="componentGrid">
                    </div>
            </div>

        </div>

        <div id="emptyState" class="text-center py-20">
            <p class="text-slate-500 uppercase tracking-widest text-sm font-semibold">Enter a location to initialize atmospheric analysis</p>
        </div>

    </main>

    <script>
        const API_KEY = 'de99df130a4acb37c5d743be83005c80';

        async function fetchData() {
            const city = document.getElementById('cityInput').value.trim();
            if (!city) return;

            const btn = document.querySelector('button');
            btn.innerText = "LINKING...";

            try {
                // 1. Geocoding
                const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(city)}&limit=1&appid=${API_KEY}`);
                const geoData = await geoRes.json();

                if (!geoData || geoData.length === 0) {
                    alert("STATION NOT FOUND: Check spelling or try a larger city.");
                    btn.innerText = "UPDATE DATA";
                    return;
                }

                const { lat, lon, name, country } = geoData[0];

                // 2. Pollution Data
                const polRes = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`);
                
                // Handling "Unauthorized" if key is still activating
                if (polRes.status === 401) {
                    alert("API KEY PENDING: Your key is still activating. Try again in 15 minutes.");
                    return;
                }

                const polData = await polRes.json();
                renderDashboard(name, country, polData.list[0]);

            } catch (err) {
                console.error(err);
                alert("CONNECTION ERROR: Verify internet and API status.");
            } finally {
                btn.innerText = "UPDATE DATA";
            }
        }

        function renderDashboard(city, country, payload) {
            const aqi = payload.main.aqi;
            const comps = payload.components;
            
            // Mega Weather Table Configuration
            const config = {
                1: { label: "Good", color: "#10b981", desc: "Air quality is considered satisfactory, and air pollution poses little or no risk." },
                2: { label: "Fair", color: "#84cc16", desc: "Air quality is acceptable; however, some pollutants may be a moderate concern." },
                3: { label: "Moderate", color: "#f59e0b", desc: "Members of sensitive groups may experience health effects." },
                4: { label: "Poor", color: "#ef4444", desc: "Everyone may begin to experience health effects; sensitive groups more seriously." },
                5: { label: "Very Poor", color: "#7c3aed", desc: "Health warnings of emergency conditions. The entire population is likely to be affected." }
            };

            const ui = config[aqi];

            // Update UI
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('cityNameDisplay').innerText = `${city}, ${country}`;
            document.getElementById('aqiValue').innerText = aqi;
            document.getElementById('aqiLabel').innerText = ui.label;
            document.getElementById('aqiLabel').style.color = ui.color;
            document.getElementById('aqiDesc').innerText = ui.desc;
            document.getElementById('mainCard').style.borderColor = ui.color;
            document.getElementById('lastUpdated').innerText = "STATION UPDATED: " + new Date().toLocaleTimeString();

            // Render Pollutant Grid
            const pollutants = [
                { id: "SO₂", val: comps.so2 },
                { id: "NO₂", val: comps.no2 },
                { id: "PM10", val: comps.pm10 },
                { id: "PM2.5", val: comps.pm2_5 },
                { id: "O₃", val: comps.o3 },
                { id: "CO", val: comps.co }
            ];

            document.getElementById('componentGrid').innerHTML = pollutants.map(p => `
                <div class="stat-card">
                    <div class="text-slate-500 text-xs font-bold mb-1">${p.id}</div>
                    <div class="text-2xl font-bold">${p.val.toFixed(1)}</div>
                    <div class="text-[10px] text-slate-600 font-mono">μg/m³</div>
                </div>
            `).join('');
        }
    </script>
    <div style="background: #1e293b; padding: 10px; text-align: center;">
    <a href="compare.html" style="color: #60a5fa; font-weight: bold; text-decoration: none;"> 
       ➜ Switch to Task 02: Price Comparator
    </a>
</div>
</body>

</html>
